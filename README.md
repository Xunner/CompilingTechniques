# CompilingTechniques

## Motivation/Aim

​	编写、调试⼀个简易SQL词法分析程序，对基础SQL语句进⾏词法分析，从⽽更好理解词法分析原理；深⼊体会正则表达式转化为NFA、NFA转化为DFA、DFA优化并转化为后续代码的过程。 

## Content description

​	程序⽤Java编写。程序读取⼀个⽂本⽂件，并对其中的内容进⾏词法分析，此程序基本实现了对SQL语言的词法识别，可识别并去除注释，识别字符串、数字、保留字（或标识符）、操作符和分隔符，并输出格式为<识别的单词符号, 种别码>的Token序列；对不符合可识别格式的字符进⾏报错，并指明所在⾏数。

## Ideas/Methods

  1. 针对要识别的单词符号写出正则表达式 
  2. 构造出每个正则表达式对应的NFA，并合并为一个NFA
  3. 将NFA化简为最小DFA 
  4. 基于最小DFA编写代码 
  5. 先读取⼀个输⼊字符，判断其可能的类别，再读取下⼀个继续判断，若已经识别出则
    添加到输出token序列，多读的需要退回，否则继续依次读取下⼀个字符，直到结束符为⽌ 

## Assumptions

  1. 保留字的识别优先级⾼于标识符
  2. 输入文件的编码为UTF-8
  3. 字符全集为`\t`、`\n`以及ASCII码中的所有可打印字符，输⼊⽂件内容也仅由这些字符组成
  4. 未被反引号`` ` ``括起的标识符不以数字开头

## Related FA descriptions

### 1. RE（按识别优先级从高到低）

#### 1) 注释

​	`com -> #[^\n]*(\n|$)|/\*([^\*]|\*[^/]+)*\*{1,2}/`

#### 2) 字符串

​	`str -> "[^"\n]*"|'[^'\n]*'`

#### 3) 数字

​	`num -> \d+(\.\d+)?`

#### 4) 保留字和标识符：

​	``word -> [a-zA-Z_]\w*|`\w+` ``

#### 5) 操作符

​	`op -> !=|<>|<=|>=|[=<>+-*/!^&.]`

#### 6) 分隔符

​	`sep -> [(){};,]`



### 2. NFA

![NFA](resources/NFA.png)



### 3. Dtran table

| NFA state           | DFA state | change                                                       |
| ------------------- | --------- | ------------------------------------------------------------ |
| {0,1,5,14}          | S1        | [a-zA-Z_] → S2<br>` → S3<br>\d → S4<br>[+-/&*.^,;(){}] → S5<br>< → S6<br>! → S7<br>> → S8<br>" → S9<br>' → S10<br>/ → S11<br># → S12 |
| {2,23}              | S2        | \w → S2                                                      |
| {3}                 | S3        | \w → S13                                                     |
| {6,24}              | S4        | \d → S4<br>. → S14                                           |
| {25}                | S5        | ∅                                                            |
| {9,25}              | S6        | [>=] → S5                                                    |
| {10,25}             | S7        | = → S5                                                       |
| {11,25}             | S8        | = → S5                                                       |
| {12}                | S9        | [^"\n] → S9<br>" → S15                                       |
| {13}                | S10       | [^'\n] → S10<br>' → S15                                      |
| {15,25}             | S11       | * → S16                                                      |
| {22}                | S12       | [^\n] → S12<br>\n\|$ → S17                                   |
| {4}                 | S13       | \w → S13<br>` → S18                                          |
| {7}                 | S14       | \d → S19                                                     |
| {26}                | S15       | ∅                                                            |
| {16,19,20}          | S16       | * → S20<br>\[^*] → S16                                       |
| {27}                | S17       | ∅                                                            |
| {23}                | S18       | ∅                                                            |
| {8,24}              | S19       | \d → S19                                                     |
| {17,20,21}          | S20       | * → S21<br>/ → S17<br>\[^*/] → S22                           |
| {16,18,19,20,21}    | S21       | * → S23<br>/ → S24<br>\[^*/] → S22                           |
| {16,18,19,20}       | S22       | * → S23<br>/ → S16<br>\[^*/] → S22                           |
| {16,17,18,19,20,21} | S23       | * → S23<br>/ → S24<br>\[^*/] → S22                           |
| {16,19,20,27}       | S24       | * → S20<br>\[^*] → S16                                       |



### 4. DFA with minimum states

![DFA](resources/DFA.png)

## Description of important Data Structures

## Description of core Algorithms

## Use cases on running

## Problems occurred and related solutions

## Your feelings and comments

